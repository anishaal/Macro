import tkinter as tk
from tkinter import messagebox
import win32com.client as win32
import os

EXCEL_FILE = r"C:\Path\YourMacroWorkbook.xlsm"  # <-- change this
MACRO_NAME = "YourMacroName"                    # <-- change this

def run_macro():
    site_id = entry.get().strip()

    if not site_id:
        messagebox.showwarning("Input Error", "Please enter a Site ID.")
        return

    if not os.path.exists(EXCEL_FILE):
        messagebox.showerror("File Error", "Excel macro file not found.")
        return

    try:
        messagebox.showinfo("Running", "Running macro, please wait...")

        excel = win32.Dispatch("Excel.Application")
        excel.Visible = False  # run in background

        wb = excel.Workbooks.Open(EXCEL_FILE)

        # Pass Site ID to the macro
        excel.Application.Run(f"'{wb.Name}'!{MACRO_NAME}", site_id)

        wb.Close(SaveChanges=True)
        excel.Quit()

        messagebox.showinfo("Success", "Macro completed successfully!")

    except Exception as e:
        messagebox.showerror("Error", f"An error occurred:\n{e}")

# UI Setup
root = tk.Tk()
root.title("Site Macro Runner")
root.geometry("350x180")
root.resizable(False, False)

label = tk.Label(root, text="Enter Site ID:", font=("Arial", 12))
label.pack(pady=10)

entry = tk.Entry(root, width=30, font=("Arial", 12))
entry.pack()

run_button = tk.Button(root, text="Run Macro", font=("Arial", 12), command=run_macro)
run_button.pack(pady=20)

root.mainloop()
